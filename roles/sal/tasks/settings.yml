---
# sal/tasks/settings.yml
- name: copy example_settings.py
  sudo: True
  copy: src={{ sal_settings_path }}/example_settings.py
        dest={{ sal_settings_path }}/settings.py

#- name: edit settings.py
#  sudo: True
#  lineinfile: dest={{ sal_settings_path }}/settings.py
#              regexp={{ item.regex }}
#              line={{ item.line }}
#  with_items:
#    - { regex: "Your Name"     , line: "('juan', 'juan@ninjabong.com')" }
#    - { regex: "^TIME_ZONE"    , line: "TIMEZONE = '{{ sal_timezone }}'" }
#    - { regex: "^DISPLAY_NAME" , line: "DISPLAY_NAME = {{ sal_display_name }}" }

- name: edit settings.py - ADMIN
  sudo: True
  lineinfile: dest={{ sal_settings_path }}/settings.py
              regexp='Your Name'
              line="     ('{{ ansible_user_id }}', '{{ ansible_user_id }}@{{ ansible_domain }}')"

- name: edit settings.py - TIME_ZONE
  sudo: True
  lineinfile: dest={{ sal_settings_path }}/settings.py
              regexp="^TIME_ZONE"
              line="TIME_ZONE = '{{ sal_timezone }}'"

- name: edit settings.py - DISPLAY_NAME
  sudo: True
  lineinfile: dest={{ sal_settings_path }}/settings.py
              regexp="^DISPLAY_NAME"
              line="DISPLAY_NAME = '{{ sal_display_name }}'"

- name: change sal's settings.py to use our mysql settings
  sudo: True
  replace: dest={{ sal_settings_path }}/settings.py
           regexp={{ item.regex }}
           replace={{ item.new }}
  with_items:
    - { regex: "backends.sqlite3"                     , new: "backends.mysql" }
    - { regex: "os.path.join(PROJECT_DIR, 'sal.db')," , new: "'{{ sal_db_name }}'," }
    - { regex: "^'USER': ''"                          , new: "        'USER': '{{ sal_mysql_user }}'" }
    - { regex: "^'PASSWORD': ''"                      , new: "        'PASSWORD': '{{ sal_mysql_passwd }}'" }
  when: sal_use_mysql == True

#'ENGINE': 'django.db.backends.mysql', # Add 'postgresql_psycopg2', 'mysql', 'sqlite3' or 'oracle'.
#        'NAME': 'DATABASENAME',                      # Or path to database file if using sqlite3.
        # The following settings are not used with sqlite3:
#        'USER': 'DATABASEUSER',
#        'PASSWORD': 'PASSWORD',
#        'HOST': '',                      # Empty for localhost through domain sockets or '127.0.0.1' for localhost through TCP.
#        'PORT': '',                      # Set to empty string for default.